<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>Input soal | Britsedu</title>
    <%- include('../../partials/head') %>
        <link crossorigin="anonymous"
            integrity="sha384-7kltdnODhBho8GSWnwD9l9rilXkpuia4Anp4TKHPOrp8/MS/+083g4it4MYED/hc"
            href="https://lib.baomitu.com/quill/2.0.0-dev.3/quill.snow.min.css" rel="stylesheet" />
        <script crossorigin="anonymous"
            integrity="sha384-MDio1/ps0nK1tabxUqZ+1w2NM9faPltR1mDqXcNleeuiSi0KBXqIsWofIp4r5A0+"
            src="https://lib.baomitu.com/quill/2.0.0-dev.3/quill.min.js"></script>
        <link href="<%= hostname %>dashboard/css/styles.css" rel="stylesheet" />
        <link rel="stylesheet" href="<%= hostname %>dashboard/css/math-modal.css">
        <link href="https://cdn.jsdelivr.net/npm/simple-datatables@latest/dist/style.css" rel="stylesheet" />
        <script data-search-pseudo-elements defer
            src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/js/all.min.js"
            crossorigin="anonymous"></script>

        <script>
            window.MathJax = {
                tex: {
                    inlineMath: [['$', '$']],
                    displayMath: [['$$', '$$']],
                },
                svg: {
                    fontCache: 'global'
                },
                options: {
                    ignoreHtmlClass: "ignore-math", // Skip elements with this class
                    processHtmlClass: "process-math" // Only process elements with this class
                },
                startup: {
                    ready: () => {
                        MathJax.startup.defaultReady();
                        // Additional configuration to ensure Quill editors are ignored
                        MathJax.startup.document.updateDocument();
                    }
                }
            };
        </script>
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
        
        <!-- Quill JS -->
        <link href="https://cdn.quilljs.com/2.0.0-dev.3/quill.snow.css" rel="stylesheet">
        <script src="https://cdn.quilljs.com/2.0.0-dev.3/quill.js"></script>
</head>
    <body class="nav-fixed">
        <%- include('partials/topNav') %>
            <div id="layoutSidenav">
                <%- include('partials/sideNav') %>
                    <div id="layoutSidenav_content">
                        <main>
                            <div id="math-input-modal" style="display: none;">
                                <div style="display: flex; gap: 10px; align-items: flex-start; position: relative;">
                                    <!-- Main Content -->
                                    <div style="flex: 1;">
                             
                                        <textarea id="math-input" placeholder="Enter LaTeX : x^2 + y^2 = z^2" spellcheck="false"></textarea>
                            
                                        <!-- Buttons for LaTeX helpers -->
                                       
                                        <div class="card card-collapsable">
                                            <a class="card-header" style="font-size: 16px; font-weight: 400; padding: 3px 10px 3px 4px; color: black;" href="#collapseCardExample" data-bs-toggle="collapse" role="button" aria-expanded="false" aria-controls="collapseCardExample">
                                                LaTeX formula
                                                <div class="card-collapsable-arrow">
                                                    <i class="fas fa-chevron-down"></i>
                                                </div>
                                            </a>
                                            <div class="collapse show" id="collapseCardExample">
                                                <div class="card-body" style="padding: 0 10px;">
                                                    <%- include ('partials/latex-button') %>
                                                </div>
                                            </div>
                                        </div>
                                        <div id="math-preview" class="preview"></div>
                            
                                        <button class="save" style="background-color: green; color: white;">Insert</button>
                                        <button class="cancel" style="background-color: red; color: white;">Cancel</button>
                                    </div>
                                    <!-- Sidebar for Symbols -->
                                    <%- include ('partials/latex-sidebar') %>
                                </div>
                            </div>
                            
                            <header class="page-header page-header-dark bg-gradient-primary-to-secondary pb-10">
                                <div class="container-xl px-4">
                                    <div class="page-header-content pt-4">
                                        <div class="row align-items-center justify-content-between">
                                            <div class="col-auto mt-4">
                                                <h1 class="page-header-title">
                                                    <div class="page-header-icon"><i data-feather="alert-circle"></i>
                                                    </div>
                                                    Welcome, Master!
                                                </h1>
                                                <div class="page-header-subtitle">Britsedu, <span
                                                        style="font-style: italic;">your key to excel</span></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </header>
                            <!-- Main page content-->
                            <div class="container-xl px-4 mt-n10">



                                <form method="POST" id="formsoal"
                                    action="/admin/manajemen-soal/mapel/<%= mapel.dataValues?.kodekategori %>/<%= nomorSoal %>">






                                    <div class="card shadow mb-5">
                                        <div class="card-header py-3">

                                            <p class="text-primary m-0 fw-bold">Soal <%= mapel.dataValues.mapel + " " +
                                                    paket %>
                                            </p>
                                        </div>
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-md-6 text-nowrap">
                                                    <div id="dataTable_length" class="dataTables_length"
                                                        aria-controls="dataTable"><label class="form-label">Pilih nomor
                                                            <input type="number" value="<%= nomorSoal %>" name="no"
                                                                id="nomorSoal">
                                                        </label> <button type="button" class="btn btn-primary btn-sm"
                                                            id="changeSoal" onclick="gantiSoal()">Ganti</button></div>
                                                </div>

                                            </div>
                                            <% console.log(datas.dataValues?.content) %>
                                                <div class="row" style="height: 300px;">
                                                    <div class="col-12">
                                                        <div id="editorSoalContent" class="editorContainer ignore-math quill-editor" spellcheck="false">
                                                        </div>
                                                        <textarea class="form-control" id="soalContent" name="content"
                                                            form="formsoal"
                                                            style="display:none"><%= datas.dataValues?.content %></textarea>
                                                    </div>

                                                </div>
                                                <div class="row">
                                                    <div class="col-12">
                                                        <button class="btn btn-primary btn-sm" type="submit"
                                                            style="margin-top: 60px;">
                                                            Simpan perubahan
                                                        </button>
                                                        <a href="<%= backUrl %>"><button class="btn btn-warning btn-sm"
                                                                type="button"
                                                                style="margin-top: 60px;color: rgb(255,255,255);margin-left: 5px;">
                                                                Kembali
                                                            </button></a>
                                                    </div>

                                                </div>

                                        </div>
                                    </div>
                                    <div class="card shadow mb-5">
                                        <div class="card-header py-3">
                                            <p class="text-primary m-0 fw-bold">Pilihan A :</p>
                                        </div>
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col">
                                                    <div id="editorA" class="editorContainer ignore-math quill-editor" spellcheck="false"></div>
                                                    <textarea class="form-control" id="pilihanA" name="a"
                                                        form="formsoal"
                                                        style="display:none"><%= datas.dataValues?.a %></textarea>

                                                </div>
                                            </div>
                                            <button class="btn btn-primary btn-sm" type="submit"
                                                style="margin-top: 60px;">
                                                Simpan perubahan
                                            </button>
                                            <a href="<%= backUrl %>"><button class="btn btn-warning btn-sm"
                                                    type="button"
                                                    style="margin-top: 60px;color: rgb(255,255,255);margin-left: 5px;">
                                                    Kembali
                                                </button></a>
                                        </div>
                                    </div>
                                    <div class="card shadow mb-5">
                                        <div class="card-header py-3">
                                            <p class="text-primary m-0 fw-bold">Pilihan B :</p>
                                        </div>
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col">
                                                    <div id="editorB" class="editorContainer ignore-math quill-editor" spellcheck="false"></div>
                                                    <textarea class="form-control" id="pilihanB" name="b"
                                                        form="formsoal"
                                                        style="display:none"><%= datas.dataValues?.b %></textarea>
                                                </div>
                                            </div>
                                            <button class="btn btn-primary btn-sm" type="submit"
                                                style="margin-top: 60px;">
                                                Simpan perubahan
                                            </button>
                                            <a href="<%= backUrl %>"><button class="btn btn-warning btn-sm"
                                                    type="button"
                                                    style="margin-top: 60px;color: rgb(255,255,255);margin-left: 5px;">
                                                    Kembali
                                                </button></a>
                                        </div>
                                    </div>
                                    <div class="card shadow mb-5">
                                        <div class="card-header py-3">
                                            <p class="text-primary m-0 fw-bold">Pilihan C :</p>
                                        </div>
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col">
                                                    <div id="editorC" class="editorContainer ignore-math quill-editor" spellcheck="false"></div>
                                                    <textarea class="form-control" id="pilihanC" name="c"
                                                        form="formsoal"
                                                        style="display:none"><%= datas.dataValues?.c %></textarea>
                                                </div>
                                            </div>
                                            <button class="btn btn-primary btn-sm" type="submit"
                                                style="margin-top: 60px;">
                                                Simpan perubahan
                                            </button>
                                            <a href="<%= backUrl %>"><button class="btn btn-warning btn-sm"
                                                    type="button"
                                                    style="margin-top: 60px;color: rgb(255,255,255);margin-left: 5px;">
                                                    Kembali
                                                </button></a>
                                        </div>
                                    </div>
                                    <div class="card shadow mb-5">
                                        <div class="card-header py-3">
                                            <p class="text-primary m-0 fw-bold">Pilihan D :</p>
                                        </div>
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col">
                                                    <div id="editorD" class="editorContainer ignore-math quill-editor" spellcheck="false"></div>
                                                    <textarea class="form-control" id="pilihanD" name="d"
                                                        form="formsoal"
                                                        style="display:none"><%= datas.dataValues?.d %></textarea>
                                                </div>
                                            </div>
                                            <button class="btn btn-primary btn-sm" type="submit"
                                                style="margin-top: 60px;">
                                                Simpan perubahan
                                            </button>
                                            <a href="<%= backUrl %>"><button class="btn btn-warning btn-sm"
                                                    type="button"
                                                    style="margin-top: 60px;color: rgb(255,255,255);margin-left: 5px;">
                                                    Kembali
                                                </button></a>
                                        </div>
                                    </div>
                                    <div class="card shadow mb-5">
                                        <div class="card-header py-3">
                                            <p class="text-primary m-0 fw-bold">Pilihan E :</p>
                                        </div>
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col">
                                                    <div id="editorE" class="editorContainer ignore-math quill-editor" spellcheck="false"></div>
                                                    <textarea class="form-control" id="pilihanE" name="e"
                                                        form="formsoal"
                                                        style="display:none"><%= datas.dataValues?.e %></textarea>

                                                </div>
                                            </div>
                                            <button class="btn btn-primary btn-sm" type="submit"
                                                style="margin-top: 60px;">
                                                Simpan perubahan
                                            </button>
                                            <a href="<%= backUrl %>"><button class="btn btn-warning btn-sm"
                                                    type="button"
                                                    style="margin-top: 60px;color: rgb(255,255,255);margin-left: 5px;">
                                                    Kembali
                                                </button></a>
                                        </div>
                                    </div>
                                    <div class="card shadow mb-5">
                                        <div class="card-header py-3">
                                            <p class="text-primary m-0 fw-bold">Jenis soal :</p>
                                        </div>
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <select class="form-select" name="tipeSoal" id="tipeSoal">
                                                        <option value="pgbiasa" <%=datas.tipeSoal=='pgbiasa'
                                                            ? 'selected' : '' %>>Pilihan Ganda</option>
                                                        <!-- <option value="pgselect" <%=datas.tipeSoal=='pgselect'
                                                            ? 'selected' : '' %>>Select</option> -->
                                                        <option value="pgkompleks1" <%=datas.tipeSoal=='pgkompleks1'
                                                            ? 'selected' : '' %>>Benar-Salah</option>
                                                        <option value="pgkompleks2" <%=datas.tipeSoal=='pgkompleks2'
                                                            ? 'selected' : '' %>>Memperlemah-Tidak Memperlemah</option>
                                                            <option value="isian" <%=datas.tipeSoal=='isian'
                                                            ? 'selected' : '' %>>Isian</option>
                                                    </select>
                                                </div>
                                                <!-- </div><button type="submit" class="btn btn-primary btn-sm" type="button" style="margin-top: 60px;">Simpan perubahan</button> -->
                                            </div>
                                        </div>
                                    </div>

                                    <div class="card shadow mb-5">
                                        <div class="card-header py-3">
                                            <p class="text-primary m-0 fw-bold">Jawaban Benar :</p>
                                        </div>
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col">
                                                    <input type="hidden" id="initialAnswer" value="<%= datas.dataValues?.answer %>">
                                                    <div id="answerContainer">
                                                        <!-- This will be populated by JavaScript -->
                                                    </div>
                                                </div>
                                            </div>
                                            <button type="submit" class="btn btn-primary btn-sm" style="margin-top: 10px;">
                                                Simpan perubahan
                                            </button>
                                        </div>
                                    </div>

                                    <div class="card shadow mb-5">
                                        <div class="card-header py-3">
                                            <p class="text-primary m-0 fw-bold">Pembahasan :</p>
                                        </div>
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col">
                                                    <div id="editorPembahasan" class="editorContainer ignore-math quill-editor" spellcheck="false"></div>
                                                    <textarea class="form-control" id="pembahasan" name="pembahasan" 
                                                        form="formsoal" 
                                                        style="display:none"><%= datas.dataValues?.pembahasan %></textarea>
                                                </div>
                                            </div>
                                            <button class="btn btn-primary btn-sm" type="submit" form="formsoal"
                                                style="margin-top: 60px;">
                                                Simpan perubahan
                                            </button>
                                            <a href="<%= backUrl %>"><button class="btn btn-warning btn-sm"
                                                    type="button"
                                                    style="margin-top: 60px;color: rgb(255,255,255);margin-left: 5px;">
                                                    Kembali
                                                </button></a>
                                        </div>
                                    </div>
                                </form>
                            </div>

                        </main>
                        <%- include('../../partials/footer-dashboard') %>
                    </div>
            </div>
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
                crossorigin="anonymous"></script>
            <script src="https://cdn.jsdelivr.net/npm/feather-icons@4.28.0/dist/feather.min.js" crossorigin="anonymous"></script>
            <script src="<%= hostname %>dashboard/js/scripts.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/simple-datatables@latest" crossorigin="anonymous"></script>
            <script src="<%= hostname %>dashboard/js/datatables/datatables-simple-demo.js"></script>
            <script src="<%= hostname %>dashboard/js/quillScript.js"></script>
            <script src="<%= hostname %>dashboard/js/math-input-modal.js"></script>
            <script src="<%= hostname %>dashboard/js/math-input-modal-button.js"></script>
            <script src="<%= hostname %>dashboard/js/preload-questions.js"></script>
            <script src="<%= hostname %>dashboard/js/answer-type-handler.js"></script>
            <script>
                // Ensure MathJax doesn't process Quill editors
                document.addEventListener('DOMContentLoaded', function() {
                    // Add ignore-math class to all Quill editor content areas
                    const quillEditors = document.querySelectorAll('.ql-editor');
                    quillEditors.forEach(function(editor) {
                        editor.classList.add('ignore-math');
                    });
                    
                    // Force MathJax to reprocess the document with updated classes
                    if (window.MathJax && window.MathJax.typesetPromise) {
                        window.MathJax.typesetPromise();
                    }
                });
            </script>
            <script>function gantiSoal() {
                // Get the input field value
                const nomorSoal = document.getElementById('nomorSoal').value;
            
                // Validate the input (ensure it's a valid number and not empty)
                if (!nomorSoal || isNaN(nomorSoal)) {
                    alert('Harap masukkan nomor soal yang valid!');
                    return;
                }
            
                // Get the current page's base URL
                const currentUrl = window.location.href;
            
                // Redirect to the current URL with the new value appended
                const newUrl = currentUrl.replace(/\/\d+$/, '') + `/${nomorSoal}`;
                window.location.href = newUrl;
            }
            </script>
            <script>
                const form2 = document.getElementById("formsoal")
                form2.addEventListener('keypress', function(event) {
                    // Check if the pressed key is Enter (key code 13)
                    if (event.key === 'Enter') {
                        event.preventDefault(); // Prevent the form from being submitted
                    }
                });

                // Add form submit validation
                form2.addEventListener('submit', function(event) {
                    // Extract nomor soal from URL path
                    const urlPath = window.location.pathname;
                    const urlNomorSoal = urlPath.split('/').pop(); // Get the last part of the URL
                    const inputNomorSoal = document.getElementById('nomorSoal').value;

                    if (parseInt(inputNomorSoal) !== parseInt(urlNomorSoal)) {
                        event.preventDefault();
                        alert('Nomor soal tidak sesuai dengan URL. Silakan gunakan tombol "Ganti" untuk mengganti nomor soal.');
                    }
                });
            </script>


    </body>
</html>